<div class="container py-4">
  <div *ngIf="isLoadingUser()" class="text-center py-5">
    <p-progressSpinner
      styleClass="w-4rem h-4rem"
      strokeWidth="4"
      animationDuration=".5s"
    >
    </p-progressSpinner>
    <p class="text-muted mt-3">Loading user details...</p>
  </div>

  <div
    *ngIf="!isLoadingUser() && loadUserError()"
    class="alert alert-danger"
    role="alert"
  >
    <i class="pi pi-exclamation-triangle me-2"></i>
    {{ loadUserError() }}
    <button
      pButton
      label="Go Back"
      icon="pi pi-arrow-left"
      class="p-button-text p-button-sm ms-3"
      (click)="goBack()"
    ></button>
  </div>

  <p-card
    *ngIf="!isLoadingUser() && !loadUserError() && user()"
    class="user-detail-card shadow-sm"
  >
    <ng-template pTemplate="header">
      <div
        class="card-header-custom d-flex justify-content-between align-items-center p-3"
      >
        <div class="d-flex align-items-center">
          <button
            pButton
            icon="pi pi-arrow-left"
            class="p-button-text p-button-rounded p-button-secondary me-2"
            pTooltip="Back to Users"
            tooltipPosition="bottom"
            (click)="goBack()"
          ></button>
          <h2 class="mb-0 fs-4">User Details</h2>
        </div>

        <div class="action-buttons">
          <button
            pButton
            icon="pi pi-pencil"
            class="p-button-outlined p-button-secondary p-button-sm me-2"
            pTooltip="Edit"
            tooltipPosition="bottom"
            (click)="user() && openEditUserModal(user()!)"
          ></button>
          <button
            pButton
            icon="pi pi-trash"
            class="p-button-danger p-button-outlined p-button-sm"
            pTooltip="Delete"
            tooltipPosition="bottom"
            (click)="user() && openDeleteModal(user()!)"
          ></button>
        </div>
      </div>
    </ng-template>

    <div class="p-3">
      <div class="row g-4">
        <div class="col-lg-6">
          <h3 class="section-title fs-5 fw-semibold mb-3">
            <i class="pi pi-user me-2"></i>Basic Information
          </h3>
          <p-divider class="mb-4"></p-divider>

          <dl class="row">
            <dt class="col-sm-4 text-muted fw-normal">ID:</dt>
            <dd class="col-sm-8">
              <p-tag [value]="'#' + user()?.id" severity="info"></p-tag>
            </dd>

            <dt class="col-sm-4 text-muted fw-normal">Name:</dt>
            <dd class="col-sm-8">{{ user()?.name }}</dd>

            <dt class="col-sm-4 text-muted fw-normal">Username:</dt>
            <dd class="col-sm-8">@{{ user()?.username }}</dd>

            <dt class="col-sm-4 text-muted fw-normal">Email:</dt>
            <dd class="col-sm-8">
              <a [href]="'mailto:' + user()?.email" class="info-link">
                <i class="pi pi-envelope me-1"></i>{{ user()?.email }}
              </a>
            </dd>

            <dt class="col-sm-4 text-muted fw-normal">Phone:</dt>
            <dd class="col-sm-8">
              <a [href]="'tel:' + user()?.phone" class="info-link">
                <i class="pi pi-phone me-1"></i>{{ user()?.phone }}
              </a>
            </dd>

            <dt class="col-sm-4 text-muted fw-normal">Website:</dt>
            <dd class="col-sm-8">
              <a
                [href]="'https://' + user()?.website"
                target="_blank"
                class="info-link"
              >
                <i class="pi pi-external-link me-1"></i>{{ user()?.website }}
              </a>
            </dd>
          </dl>
        </div>

        <div class="col-lg-6">
          <h3 class="section-title fs-5 fw-semibold mb-3">
            <i class="pi pi-map-marker me-2"></i>Address
          </h3>
          <p-divider class="mb-4"></p-divider>

          <dl class="row">
            <dt class="col-sm-4 text-muted fw-normal">Street:</dt>
            <dd class="col-sm-8">{{ user()?.address?.street }}</dd>

            <dt class="col-sm-4 text-muted fw-normal">Suite:</dt>
            <dd class="col-sm-8">{{ user()?.address?.suite }}</dd>

            <dt class="col-sm-4 text-muted fw-normal">City:</dt>
            <dd class="col-sm-8">{{ user()?.address?.city }}</dd>

            <dt class="col-sm-4 text-muted fw-normal">Zip Code:</dt>
            <dd class="col-sm-8">{{ user()?.address?.zipcode }}</dd>

            <dt
              *ngIf="user()?.address?.geo"
              class="col-sm-4 text-muted fw-normal"
            >
              Coordinates:
            </dt>
            <dd *ngIf="user()?.address?.geo" class="col-sm-8">
              Lat: {{ user()?.address?.geo?.lat }}, Lng:
              {{ user()?.address?.geo?.lng }}
            </dd>
          </dl>
        </div>

        <div class="col-12" *ngIf="user()?.company">
          <h3 class="section-title fs-5 fw-semibold mb-3">
            <i class="pi pi-building me-2"></i>Company
          </h3>
          <p-divider class="mb-4"></p-divider>

          <dl class="row">
            <dt class="col-sm-3 col-lg-2 text-muted fw-normal">
              Company Name:
            </dt>
            <dd class="col-sm-9 col-lg-10">{{ user()?.company?.name }}</dd>

            <dt class="col-sm-3 col-lg-2 text-muted fw-normal">Catchphrase:</dt>
            <dd class="col-sm-9 col-lg-10 fst-italic">
              "{{ user()?.company?.catchPhrase }}"
            </dd>

            <dt class="col-sm-3 col-lg-2 text-muted fw-normal">Industry:</dt>
            <dd class="col-sm-9 col-lg-10">{{ user()?.company?.bs }}</dd>
          </dl>
        </div>
      </div>
    </div>
  </p-card>

  <app-modal header="Edit User" [(visible)]="isEditUserModalVisible">
    <app-user-form
      mode="edit"
      [user]="selectedUser"
      (userSaved)="onUserUpdated($event)"
      (cancel)="onEditCancel()"
    ></app-user-form>
  </app-modal>

  <app-delete-modal
    [(visible)]="isDeleteModalVisible"
    [user]="userToDelete"
    [loading]="isDeletingUser"
    (cancel)="closeDeleteModal()"
    (confirm)="confirmDeleteUser()"
  >
  </app-delete-modal>
</div>
